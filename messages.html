<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>MusicTools Messages</title>
    <script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCkr17eHQRyOX4tlE-qluYt52AhXM7Gg0I",
      authDomain: "fir-musictools.firebaseapp.com",
      databaseURL: "https://fir-musictools.firebaseio.com",
      storageBucket: "firebase-musictools.appspot.com",
    };
    var userObject;
    var name, email, photoUrl, uid;
    firebase.initializeApp(config);
    var database = firebase.database();
    firebase.auth().onAuthStateChanged(function(user) {
      userObject = user;
      if (user) {
         // User is signed in.
        console.log("User signed in "+userObject.displayName);

      //if (user != null) {
        name = userObject.displayName;
        console.log(name);
        email = userObject.email;
        console.log(email);
        photoUrl = userObject.photoURL;
        console.log(photoUrl);
        uid = userObject.uid;
        console.log(uid);
        updateUi(name, email, photoUrl, uid);
      } else {
        // No user is signed in.
        window.location.assign("/widget");
     }
  });
  window.onload = function() {
       console.log("Window loaded");
       updateUi(name, email, photoUrl, uid);
    };
  function updateUi(username, useremail, userphotoUrl, useruid) {
    console.log("UI updating");
    document.getElementById("messages").innerHTML = username+"\n"+useremail+"\n"+userphotoUrl+"\n"+useruid;
    console.log("UI updated successfully!");
    if(useruid != null && useruid != undefined) {
      console.log("Updating database...");
      writeUserData(useruid, username, useremail, userphotoUrl);
      console.log("Done updating database");
    }
  }
  function writeUserData(theuserId, thename, theemail, theimageUrl) {
    firebase.database().ref('users/' + theuserId).update({
      name: thename,
      email: theemail,
      profilepicture : theimageUrl
    });
  }

</script>
    <link href="style.css" rel="stylesheet" type="text/css" media="screen" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div id="container">
      <h3>MusicTools Messages</h3>
      <div id="messages">
        Not Signed In!
      </div>
    </div>
    <script>
    
    </script>
  </body>
</html>
